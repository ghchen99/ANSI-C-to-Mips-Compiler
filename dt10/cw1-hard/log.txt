zl6114 : Checking we're on branch cw1-hard
cd ${REPOS}/$U && git rev-parse --abbrev-ref HEAD

log_msg "########################################################"
zl6114 : ########################################################
log_msg "## Building"
zl6114 : ## Building

log_msg "Cleaning"
zl6114 : Cleaning
(cd $REPO && rm bin/c_lexer)
(cd $REPO && make clean)
make: *** No rule to make target 'clean'.  Stop.

log_msg "Building"
zl6114 : Building
(cd $REPO && make bin/c_lexer)
flex -o lexer/c_lexer.yy.cpp lexer/c_lexer.flex
make: Warning: File 'lexer/c_lexer.yy.cpp' has modification time 26 s in the future
g++ -W -Wall -g -std=gnu++11 -o bin/c_lexer lexer/c_lexer.yy.cpp lexer/c_lexer_main.cpp
lexer/c_lexer.yy.cpp: In function ‘int yy_get_next_buffer()’:
lexer/c_lexer.yy.cpp:1252:44: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]
  if ((int) ((yy_n_chars) + number_to_move) > YY_CURRENT_BUFFER_LVALUE->yy_buf_size) {
                                            ^
lexer/c_lexer.yy.cpp: At global scope:
lexer/c_lexer.yy.cpp:1328:17: warning: ‘void yyunput(int, char*)’ defined but not used [-Wunused-function]
     static void yyunput (int c, char * yy_bp )
                 ^
make: warning:  Clock skew detected.  Your build may be incomplete.

if [[ ! -f $REPO/bin/c_lexer ]]; then
    log_msg "No executable build"
    exit 0;
fi

log_msg "########################################################"
zl6114 : ########################################################
log_msg "## Executing lexer for inputs"
zl6114 : ## Executing lexer for inputs

log_msg "Cleaning + Copying inputs"
zl6114 : Cleaning + Copying inputs
(mkdir -p $LOGDIR/working)


log_msg "Running reference lexer"
zl6114 : Running reference lexer
for i in scripts/cw1/inputs/*.c ; do
    log_msg "####################"
    NAME=$(basename $i .c)
    log_msg "  Test ${i}"

    cp $i $LOGDIR/working/$NAME.c
    cat $LOGDIR/working/$NAME.c  |  scripts/cw1/ref_tokeniser/bin/c_lexer > $LOGDIR/working/$NAME.ref.json

    cat $LOGDIR/working/$NAME.c | (cd $REPO && bin/c_lexer ) >$LOGDIR/working/$NAME.got.json 2>$LOGDIR/working/$NAME.got.stderr

    python3 scripts/cw1/compare_json.py $U $NAME $LOGDIR/working/$NAME.ref.json $LOGDIR/working/$NAME.got.json >$LOGDIR/working/$NAME.compare.csv 2>$LOGDIR/working/$NAME.compare.stderr
done
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/char-1.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/char-2.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/char-3.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/char-4.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/char-5.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/char-6.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/expr-1.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/expr-2.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/expr-3.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/expr-4.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/expr-5.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/expr-6.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/expr-7.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/expr-8.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/expr-9.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/float-1.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/float-2.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/float-3.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/float-4.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/float-5.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/float-6.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/float-8.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/float-9.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/include-0.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/include-1.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/include-2.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/include-3.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/int-1.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/int-2.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/int-3.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/int-4.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/int-5.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/int-6.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/int-7.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/pointer-1.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/pointer-2.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/pointer-3.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/pointer-4.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/stat-1.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/stat-2.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/stat-3.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/stat-4.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/stat-5.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/stat-6.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/string-1.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/string-2.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/string-3.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/string-4.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/string-5.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/string-6.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/string-7.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/string-8.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/struct-1.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/struct-2.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/struct-3.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/struct-4.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/var-decl-1.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/var-decl-2.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/var-decl-3.c
zl6114 : ####################
basename $i .c
zl6114 :   Test scripts/cw1/inputs/var-decl-4.c

cat $LOGDIR/working/*.compare.csv > $LOGDIR/working/all.compare.csv

python3 scripts/cw1/cw1-grade.py $U $LOGDIR/working/all.compare.csv $LOGDIR/$U-final.csv | tee $LOGDIR/summary.txt
    Token type | Percentage
          char |  66.67
          expr |  91.67
         float |  81.25
       include | 100.00
           int | 100.00
       pointer | 100.00
          stat | 100.00
        string |  68.75
        struct | 100.00
      var-decl | 100.00
                     |    Raw | Weight | Contrib
 Parts (token types) |  90.83 |  0.6 |  54.50
 StreamLine + Column |  83.33 |  0.2 |  16.67
 SourceFile+Line     |   1.67 |  0.2 |   0.33

Total :  71.50%

(cd $LOGDIR && tar -czf working.tar.gz working)

exit 0
zl6114 : Test Complete
